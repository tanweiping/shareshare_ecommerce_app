<!DOCTYPE html>
<html lang="en">
<head>
<style>
table {
table-layout: fixed ;
width: 100% ;
}
td {
width: 25% ;
}
</style>
  <!-- SITE TITTLE -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Share Share</title>

  <!-- FAVICON -->
  <link href="images/favicon.png" rel="shortcut icon">
  <!-- PLUGINS CSS STYLE -->
  <!-- <link href="plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet"> -->
  <!-- Bootstrap -->
  <link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="plugins/bootstrap/css/bootstrap-slider.css">
  <!-- Font Awesome -->
  <link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <!-- Owl Carousel -->
  <link href="plugins/slick-carousel/slick/slick.css" rel="stylesheet">
  <link href="plugins/slick-carousel/slick/slick-theme.css" rel="stylesheet">
  <!-- Fancy Box -->
  <link href="plugins/fancybox/jquery.fancybox.pack.css" rel="stylesheet">
  <link href="plugins/jquery-nice-select/css/nice-select.css" rel="stylesheet">
  <!-- CUSTOM CSS -->
  <link href="css/style.css" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="body-wrapper">
    <script type="text/javascript">
		if (!sessionStorage.getItem("jwt")) {
			window.location.replace("signup.html");
		}

        function signout() {
    		sessionStorage.removeItem("uname");
    		sessionStorage.removeItem("jwt");
    		window.location.replace("signup.html");
    	}
	</script>
<section>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<nav class="navbar navbar-expand-lg navbar-light navigation">
					<a class="navbar-brand" href="index.html">
						<img src="SS logo.PNG" alt="logo" width="100px" height="70px" style = "position:relative; left:5px; top:-3px;">
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
					 aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<ul class="navbar-nav ml-auto main-nav ">
							<li class="nav-item active">
								<a class="nav-link" href="index.html">Home</a>
							</li>
							<li class="nav-item dropdown dropdown-slide">
								<a class="nav-link dropdown-toggle" href="profile.html">View My Listings<span></span>
								</a>
							</li>
							<li class="nav-item dropdown dropdown-slide">
								<a class="nav-link dropdown-toggle" href="category.html"  aria-haspopup="true" aria-expanded="false">
									View All Listings <span></span>
								</a>
							</li>
							<li class="nav-item dropdown dropdown-slide">
								<a class="nav-link dropdown-toggle" href="post_listing.html"  aria-haspopup="true" aria-expanded="false">
									Add Listing<span></span>
								</a>
							</li>
						</ul>
						<ul class="navbar-nav ml-auto mt-10">
							<li class="nav-item">
								<div class="dropdown">
									<img src="profilepic.png" width="35px;">
									<span style="font-weight:bold;padding-top:10px;padding-left:10px;" id="greeting"></span>
									<div class="dropdown-content">
										<a href="profile.html">Profile</a>
									  	<a style="color:red;" onclick="signout()">Log Out</a>
									</div>
								</div>
								<script type="text/javascript">
									let name = sessionStorage.getItem("uname");
									document.getElementById("greeting").innerHTML = name;
								</script>
							</li>
						</ul>
					</div>
				</nav>
			</div>
		</div>
	</div>
</section>
<section class="page-search">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="advance-search">
					<form>
						<div class="form-row">
							<div class="form-group col-md-4">
								<input type="text" class="form-control my-2 my-lg-0" id="inputtext4" placeholder="What are you looking for">
							</div>
							<div class="form-group col-md-3">
								<input type="text" class="form-control my-2 my-lg-0" id="inputCategory4" placeholder="Category">
							</div>
							<div class="form-group col-md-3">
								<input type="text" class="form-control my-2 my-lg-0" id="inputLocation4" placeholder="Location">
							</div>
							<div class="form-group col-md-2">

								<button type="submit" class="btn btn-primary">Search Now</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</section>
<!--===================================
=            Store Section            =
====================================-->
<section class="section bg-gray">
	<!-- Container Start -->
	<div class="container">
        <hr style="border: 1px solid gray;">
		<div class="row">
			<!-- Left sidebar -->
			<div class="col-md-8">
				<div class="product-details">
                    <div style="text-align:center;">
    					<h1 class="product-title"></h1>
    					<div class="product-meta">
    						<ul class="list-inline">
    							<!-- <li class="list-inline-item"><i class="fa fa-user-o"></i> By <a href="">Andrew</a></li> -->
    							<li class="list-inline-item"><i class="fa fa-folder-open-o"></i> Category: <span id='category'></span></li>
    							<li class="list-inline-item"><i class="fa fa-location-arrow"></i> Location: <span id="location"></span></li>
    							<li class="list-inline-item"><i class="fa fa-calendar"></i> Date: <span id='sdt'></span></li>
    						</ul>
    					</div>
                    </div>
					<div class="content mt-5 pt-5">
						<div class="tab-content" id="pills-tabContent">
							<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                                <div style="text-align:center">
                                    <img class="rounded-circle img-fluid mb-3 px-3 w-50" src="" id="image">
                                </div>
                                <br>
								<table border="0">
									<tr>
										<th>Amount reached: </th>
										<td id="cqty"></td>
										<th>Aims to reach:</th>
										<td id="qty"></td>
									</tr>
									<tr>
										<th>Unit Price:</th>
										<td id="price"></td>
										<th>Due Date & Time:</th>
										<td id="dt"></td>
									</tr>
								</table>
						    </div>
							<br>
							<br>
							<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
								<h3 class="tab-title">Product Description</h3>
								<p id="proddesc">
                                </p>
						    </div>
						</div>
					</div>
					<br>
					<form action="checkout.html">
						<label for="quantity"> <h3>Quantity buying:</h3> </label>
						<input type="number" id="quantity" name="quantity" min="1" max="100">
						<br><br>
						<input hidden type="submit">
                        <button type="button" onclick="tocheckout()" class="btn btn-offer d-inline-block btn-primary ml-n1 my-1 px-lg-4 px-md-3">Join this Share Share</button>
                    </form>
				</div>
			</div>
			<div class="col-md-4">
				<div class="sidebar">
					<!-- <div class="widget price text-center">
						<h4>Price</h4>
						<p>$230</p>
					</div> -->
					<!-- User Profile widget -->
					<div class="widget user text-center">
                        <img class="rounded-circle img-fluid mb-5 px-5" src="profilepic.png" alt="">
						<!-- <h4><a href="">Jonathon Andrew</a></h4>
						<p class="member-time">Member Since Jun 27, 2017</p>
						<a href="">See all ads</a> -->
						<ul class="list-inline mt-20">
							<h2>Contact Information</h2>
							<!-- <li class="list-inline-item"><a href="" class="btn btn-contact d-inline-block  btn-primary px-lg-5 my-1 px-md-3">Contact</a></li> -->
							<p id="name"></p>
							<p id="ph"></p>
                            <p id="email"></p>
							<button id="folbtn" type="button" class="btn btn-warning" onclick="follow()">Follow</button><br>
							<!-- <li class="list-inline-item"><a href="" class="btn btn-offer d-inline-block btn-primary ml-n1 my-1 px-lg-4 px-md-3">Join this Share Share</a></li> -->
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Container End -->
</section>
<script type="text/javascript">
    let queryDict = {};
    location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]});
    var lid = queryDict['lid'];
    let url = "http://localhost:5000/listing/" + lid;
    axios.get(url)
    .then(response => {
        let data = response.data.data;
        console.log(data);
        document.getElementsByClassName("product-title")[0].innerHTML = data['productName'];
        document.getElementById('category').innerHTML = data['category'];
        document.getElementById("location").innerHTML = data['location'];
        document.getElementById("sdt").innerHTML = data['startTime'];
        document.getElementById("dt").innerHTML = data['endTime'];
        document.getElementById("cqty").innerHTML = data['currqty'];
        document.getElementById("qty").innerHTML = data['quantity'];
        document.getElementById("price").innerHTML = "$ " + data['price'];
        document.getElementById("proddesc").innerHTML = data['description'];
        document.getElementById("ph").innerHTML = data['phoneNumber'];
        document.getElementById("name").innerHTML = data['sellername'];
        document.getElementById("email").innerHTML = data['selleremail'];
        document.getElementById("image").src = data['image'];
    })
    .catch(error => {
        alert("An error occurred!!! \n" + error);
    });
</script>

<script type="text/javascript">
    function tocheckout() {
        let buyqty = document.getElementById("quantity").value;
        window.location.href = `checkout.html?lid=${lid}&qty=${buyqty}`;
    }

    function follow() {
        let jwt = sessionStorage.getItem("jwt");
        payload = JSON.parse(atob(jwt.split('.')[1]));
        let myemail = payload['sub'];
        let sellemail = document.getElementById("email").innerHTML;
        let url = "http://127.0.0.1:8000/graphql";
        let gql = `mutation {addFollower(useremail: \"${myemail}\", fEmail: \"${sellemail}\") {status}}`;
        axios.post(url, {
            query: gql
        })
        .then(response => {
            let data = response.data;
            if (data.data.addFollower != null) {
                if (data.data.addFollower.status) {
                    document.getElementById("folbtn").textContent = "Followed!";
                }
            }
        })
        .catch(error => {
            alert("An error occurred!!! \n" + error);
        });
    }
</script>
<!-- Footer Bottom -->
<footer class="footer-bottom">
	<!-- Container Start -->
	<div class="container">
	  <div class="row">
		<div class="col-sm-6 col-12">
		  <!-- Copyright -->
		  <div class="copyright">
			<p>Copyright © <script>
				var CurrentYear = new Date().getFullYear()
				document.write(CurrentYear)
			  </script>. All Rights Reserved</a></p>
		  </div>
		</div>

  <!-- To Top -->
  <div class="top-to">
    <a id="top" class="" href="#"><i class="fa fa-angle-up"></i></a>
  </div>
</footer>

<!-- JAVASCRIPTS -->
<script src="plugins/jQuery/jquery.min.js"></script>
<script src="plugins/bootstrap/js/popper.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap-slider.js"></script>
  <!-- tether js -->
<script src="plugins/tether/js/tether.min.js"></script>
<script src="plugins/raty/jquery.raty-fa.js"></script>
<script src="plugins/slick-carousel/slick/slick.min.js"></script>
<script src="plugins/jquery-nice-select/js/jquery.nice-select.min.js"></script>
<script src="plugins/fancybox/jquery.fancybox.pack.js"></script>
<script src="plugins/smoothscroll/SmoothScroll.min.js"></script>
<!-- google map -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&libraries=places"></script>
<script src="plugins/google-map/gmap.js"></script>
<script src="js/script.js"></script>
</body>
</html>
